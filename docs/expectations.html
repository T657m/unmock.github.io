<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Great Expectations · Unmock</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Now that you know how to define services in Unmock, it would be useful to assert things about how they are used. When services are defined and loaded in Unmock, they automagically reside in the `unmock.services` object. These service objects contain lots of useful properties for you to write clear and effective tests."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Great Expectations · Unmock"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.unmock.io/"/><meta property="og:description" content="Now that you know how to define services in Unmock, it would be useful to assert things about how they are used. When services are defined and loaded in Unmock, they automagically reside in the `unmock.services` object. These service objects contain lots of useful properties for you to write clear and effective tests."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/logo-purple.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-107981669-5', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Source+Code+Pro:400,700&amp;display=swap"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="//katacoda.com/embed.js"></script><script type="text/javascript" src="https://assets.digitalclimatestrike.net/widget.js" async=""></script><script type="text/javascript" src="https://unpkg.com/unmock-gitter@0.0.0/index.js"></script><script type="text/javascript" src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-white.svg" alt="Unmock"/><h2 class="headerTitleWithLogo">Unmock</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="https://github.com/unmock/unmock-js" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Basic Usage</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/example">A Motivating Example</a></li><li class="navListItem"><a class="navItem" href="/docs/resources">More Resources</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Services</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/unmock">Defining Services</a></li><li class="navListItem"><a class="navItem" href="/docs/openapi">Using OpenAPI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Basic Usage</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/expectations">Great Expectations</a></li><li class="navListItem"><a class="navItem" href="/docs/setting-state">Initializing Mocks</a></li><li class="navListItem"><a class="navItem" href="/docs/fuzz">Fuzz Testing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced Usage</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/jest-reporter">Jest Reporter</a></li><li class="navListItem"><a class="navItem" href="/docs/configuration">Configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/react-native">React Native</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Community</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/code-of-conduct">Code of Conduct</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Roadmap</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/roadmap">Where we&#x27;re going</a></li><li class="navListItem"><a class="navItem" href="/docs/contributing">Contributing</a></li><li class="navListItem"><a class="navItem" href="/docs/about">About us</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/unmock/unmock.github.io/edit/source/docs/expectations.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Great Expectations</h1></header><article><div><span><p>Now that you know how to define services in Unmock, it would be useful to assert things about how they are used. When services are defined and loaded in Unmock, they automagically reside in the <code>unmock.services</code> object. These service objects contain lots of useful properties for you to write clear and effective tests.</p>
<h2><a class="anchor" aria-hidden="true" id="spying"></a><a href="#spying" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Spying</h2>
<p>Unmock uses <strong><a href="https://sinonjs.org/releases/v7.4.1/spies/">Sinon JS Spies</a></strong> to give you access to the number of times an API is called, its return value, and other bits of useful information. You can check out the <a href="https://sinonjs.org/releases/v7.4.1/spies/">SinonJS documentation</a> for more information on the types of assertions that can be made with spies. The section below acts as a cookbook for writing great tests with spies.</p>
<p>Spies are properties of services. So, for example, to get the spy for GitHub, you would call:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> {
  <span class="hljs-attr">services</span>: { github },
} = unmock.on(); <span class="hljs-comment">// Activate unmock and load services</span>
<span class="hljs-keyword">const</span> githubSpy = github.spy;
</code></pre>
<p>An unmock spy has all the properties documented in the <a href="https://sinonjs.org/releases/v7.4.1/spies/">SinonJS documentation</a>. In addition to this, it has some useful functions that can help when working with HTTP(S) related concepts, like request or response bodies.</p>
<h2><a class="anchor" aria-hidden="true" id="paths-and-headers-and-bodies-oh-my"></a><a href="#paths-and-headers-and-bodies-oh-my" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Paths and Headers and Bodies, Oh My!</h2>
<p>When working with network calls, we will often want to make assertions like the right path was called, the right header was used or the right body was returned. Unmock spies have some useful functions for this that follow a basic convention.</p>
<blockquote>
<p><code>&lt;method&gt;&lt;Op&gt;(/* matcher */)</code></p>
</blockquote>
<ul>
<li><p><strong>method</strong> is one of <code>get</code>, <code>post</code>, <code>put</code>, and <code>delete</code>.</p></li>
<li><p><strong>Op</strong> is one of <code>requestHost</code>, <code>requestBody</code>, and <code>responseBody</code>. An exception is thrown if multiple calls matching the pattern are found.</p></li>
<li><p><strong>matcher</strong>, which is optional, is a <a href="https://sinonjs.org/releases/v7.4.1/matchers/">SinonJS matcher</a>. For example, if you use <code>getPaths</code>, you may want to only match against paths in the form <code>user/{id}</code> - you would pass <code>sinon.match({ path: sinon.match(&quot;user/&quot;) })</code> to <code>getPaths</code>. The arguments passed to <code>sinon.match</code> should be properties of the <a href="#unmockrequest">UnmockRequest</a> object. If you're not using <code>sinon</code> in your project, you can import it from <code>unmock</code>:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> { sinon } <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;
</code></pre></li>
</ul>
<p>Below is a test using <code>expect</code> together with <code>postRequestBody</code> and <code>postResponseBody</code> to verify the request body of a post request as well as the code output.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-1-tab-2" class="nav-link active" data-group="group_1" data-tab="tab-group-1-content-2">Test</div><div id="tab-group-1-tab-3" class="nav-link" data-group="group_1" data-tab="tab-group-1-content-3">Code</div><div id="tab-group-1-tab-4" class="nav-link" data-group="group_1" data-tab="tab-group-1-content-4">Service spec</div></div><div class="tab-content"><div id="tab-group-1-content-2" class="tab-pane active" data-group="group_1" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.test.js</span><br /><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;<br /><span class="hljs-keyword">import</span> postAugmentedUser <span class="hljs-keyword">from</span> <span class="hljs-string">"./postAugmentedUser"</span>;<br /><br /><span class="hljs-keyword">let</span> myapi;<br /><br />beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi = unmock.on().services.myapi;<br />});<br /><br />test(<span class="hljs-string">"augmented user object composed correctly"</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />  <span class="hljs-keyword">const</span> augmentedUser = <span class="hljs-keyword">await</span> postAugmentedUser(<span class="hljs-number">42</span>, <span class="hljs-string">"Jane"</span>, <span class="hljs-string">"Fishing"</span>);<br />  <span class="hljs-keyword">const</span> requestBody = myapi.spy.postRequestBody();<br />  <span class="hljs-comment">// Verify request</span><br />  expect(requestBody).toBe({<br />    <span class="hljs-attr">name</span>: <span class="hljs-string">"Jane"</span>,<br />    <span class="hljs-attr">hobby</span>: <span class="hljs-string">"Fishing"</span>,<br />  });<br />  <span class="hljs-comment">// Access response body</span><br />  <span class="hljs-keyword">const</span> responseBody = myapi.spy.postResponseBody();<br />  <span class="hljs-comment">// Verify output has all properties of `responseBody`</span><br />  expect(augmentedUser).toMatchObject(responseBody);<br />  expect(augmentedUser).toHaveProperty(<span class="hljs-string">"seenInSession"</span>, <span class="hljs-literal">false</span>);<br />});<br /><br />afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi.spy.reset();<br />});<br /></code></pre>
</span></div></div><div id="tab-group-1-content-3" class="tab-pane" data-group="group_1" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.js</span><br /><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> (id, name, hobby) =&gt; {<br />  <span class="hljs-keyword">const</span> { data } = axios.post(<span class="hljs-string">"https://myapi.com/users/"</span> + id, { name, hobby });<br />  <span class="hljs-keyword">return</span> {<br />    ...data,<br />    <span class="hljs-attr">fetchedOn</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br />    <span class="hljs-attr">seenInSession</span>: <span class="hljs-literal">false</span>,<br />  };<br />};<br /></code></pre>
</span></div></div><div id="tab-group-1-content-4" class="tab-pane" data-group="group_1" tabindex="-1"><div><span><pre><code class="hljs css language-yaml"><span class="hljs-comment"># __unmock__/myapi/openapi.yaml</span><br /><span class="hljs-attr">openapi:</span> <span class="hljs-number">3.0</span><span class="hljs-number">.0</span><br /><span class="hljs-attr">info:</span><br /><span class="hljs-attr">  version:</span> <span class="hljs-string">"1.0"</span><br /><span class="hljs-attr">  title:</span> <span class="hljs-string">"myapi"</span><br /><br /><span class="hljs-attr">paths:</span><br />  <span class="hljs-string">/users/{id}:</span><br /><span class="hljs-attr">    parameters:</span><br /><span class="hljs-attr">      - name:</span> <span class="hljs-string">id</span><br /><span class="hljs-attr">        in:</span> <span class="hljs-string">path</span><br /><span class="hljs-attr">        description:</span> <span class="hljs-string">User</span> <span class="hljs-string">ID</span><br /><span class="hljs-attr">        required:</span> <span class="hljs-literal">true</span><br /><span class="hljs-attr">        schema:</span><br /><span class="hljs-attr">          type:</span> <span class="hljs-string">integer</span><br /><span class="hljs-attr">          format:</span> <span class="hljs-string">int32</span><br /><span class="hljs-attr">    post:</span><br /><span class="hljs-attr">      responses:</span><br />        <span class="hljs-string">"200"</span><span class="hljs-string">:</span><br /><span class="hljs-attr">          description:</span> <span class="hljs-string">"User"</span><br /><span class="hljs-attr">          content:</span><br />            <span class="hljs-string">application/json:</span><br /><span class="hljs-attr">              schema:</span><br /><span class="hljs-attr">                type:</span> <span class="hljs-string">object</span><br /><span class="hljs-attr">                required:</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">id</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">name</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">hobbies</span><br /><span class="hljs-attr">                properties:</span><br /><span class="hljs-attr">                  id:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">number</span><br /><span class="hljs-attr">                  name:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">string</span><br /><span class="hljs-attr">                  hobbies:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">array</span><br /><span class="hljs-attr">                    items:</span><br /><span class="hljs-attr">                      type:</span> <span class="hljs-string">string</span><br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="advanced-usage"></a><a href="#advanced-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advanced usage</h2>
<p>When possible, you should use functions like <code>postRequestBody</code> or <code>postRequestHost</code> above to reason about HTTP(S) calls. They make your test easier to read and maintain. However, sometimes, you may need to make more fine grained assertions having to do with the order of network calls or other subtleties. In this case, you'll want to use the full power of SinonJS spies.</p>
<p>Below is a test that uses only SinonJS spy properties such as <code>callCount</code> and <code>firstCall</code> to inspect <a href="https://sinonjs.org/releases/v7.4.1/spy-call/">spy calls</a> and their return values (<code>firstCall.returnValue.body</code>).</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-5-tab-6" class="nav-link active" data-group="group_5" data-tab="tab-group-5-content-6">Test</div><div id="tab-group-5-tab-7" class="nav-link" data-group="group_5" data-tab="tab-group-5-content-7">Code</div><div id="tab-group-5-tab-8" class="nav-link" data-group="group_5" data-tab="tab-group-5-content-8">Service spec</div></div><div class="tab-content"><div id="tab-group-5-content-6" class="tab-pane active" data-group="group_5" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.test.js</span><br /><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;<br /><span class="hljs-keyword">import</span> postAugmentedUser <span class="hljs-keyword">from</span> <span class="hljs-string">"./postAugmentedUser"</span>;<br /><br /><span class="hljs-keyword">let</span> myapi;<br /><br />beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi = unmock.on().services.myapi;<br />});<br /><br />test(<span class="hljs-string">"augmented user object composed correctly"</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />  <span class="hljs-keyword">const</span> augmentedUser = <span class="hljs-keyword">await</span> postAugmentedUser(<span class="hljs-number">42</span>, <span class="hljs-string">"Jane"</span>, <span class="hljs-string">"Fishing"</span>);<br />  expect(myapi.spy.callCount).toBe(<span class="hljs-number">1</span>);<br />  <span class="hljs-keyword">const</span> firstCall = myapi.spy.firstCall;<br />  <span class="hljs-comment">// Verify request</span><br />  expect(firstCall.args[<span class="hljs-number">0</span>].body).toBe({<br />    <span class="hljs-attr">name</span>: <span class="hljs-string">"Jane"</span>,<br />    <span class="hljs-attr">hobby</span>: <span class="hljs-string">"Fishing"</span>,<br />  });<br />  <span class="hljs-comment">// Verify code's return value</span><br />  expect(augmentedUser).toMatchObject(firstCall.returnValue.body);<br />});<br /><br />test(<span class="hljs-string">"augmented user does not have race conditions"</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />  <span class="hljs-keyword">const</span> augmentedUsers = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(<br />    [[<span class="hljs-number">42</span>, <span class="hljs-string">"Jane"</span>, <span class="hljs-string">"Fishing"</span>], [<span class="hljs-number">43</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Reading"</span>]].map(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span><br />      postAugmentedUser.apply(<span class="hljs-literal">null</span>, i)<br />    )<br />  );<br />  expect(myapi.spy.callCount).toBe(<span class="hljs-number">2</span>);<br />  expect(augmentedUsers[<span class="hljs-number">0</span>]).toMatchObject(myapi.spy.firstCall.returnValue.body);<br />  expect(augmentedUsers[<span class="hljs-number">1</span>]).toMatchObject(<br />    myapi.spy.secondCall.returnValue.body<br />  );<br />});<br /><br />afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi.reset();<br />});<br /></code></pre>
</span></div></div><div id="tab-group-5-content-7" class="tab-pane" data-group="group_5" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.js</span><br /><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> (id, name, hobby) =&gt; {<br />  <span class="hljs-keyword">const</span> { data } = axios.post(<span class="hljs-string">"https://myapi.com/users/"</span> + id, { name, hobby });<br />  <span class="hljs-keyword">return</span> {<br />    ...data,<br />    <span class="hljs-attr">fetchedOn</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br />    <span class="hljs-attr">seenInSession</span>: <span class="hljs-literal">false</span>,<br />  };<br />};<br /></code></pre>
</span></div></div><div id="tab-group-5-content-8" class="tab-pane" data-group="group_5" tabindex="-1"><div><span><pre><code class="hljs css language-yaml"><span class="hljs-comment"># __unmock__/myapi/openapi.yaml</span><br /><span class="hljs-attr">openapi:</span> <span class="hljs-number">3.0</span><span class="hljs-number">.0</span><br /><span class="hljs-attr">info:</span><br /><span class="hljs-attr">  version:</span> <span class="hljs-string">"1.0"</span><br /><span class="hljs-attr">  title:</span> <span class="hljs-string">"myapi"</span><br /><br /><span class="hljs-attr">paths:</span><br />  <span class="hljs-string">/users/{id}:</span><br /><span class="hljs-attr">    parameters:</span><br /><span class="hljs-attr">      - name:</span> <span class="hljs-string">id</span><br /><span class="hljs-attr">        in:</span> <span class="hljs-string">path</span><br /><span class="hljs-attr">        description:</span> <span class="hljs-string">User</span> <span class="hljs-string">ID</span><br /><span class="hljs-attr">        required:</span> <span class="hljs-literal">true</span><br /><span class="hljs-attr">        schema:</span><br /><span class="hljs-attr">          type:</span> <span class="hljs-string">integer</span><br /><span class="hljs-attr">          format:</span> <span class="hljs-string">int32</span><br /><span class="hljs-attr">    post:</span><br /><span class="hljs-attr">      responses:</span><br />        <span class="hljs-string">"200"</span><span class="hljs-string">:</span><br /><span class="hljs-attr">          description:</span> <span class="hljs-string">"User"</span><br /><span class="hljs-attr">          content:</span><br />            <span class="hljs-string">application/json:</span><br /><span class="hljs-attr">              schema:</span><br /><span class="hljs-attr">                type:</span> <span class="hljs-string">object</span><br /><span class="hljs-attr">                required:</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">id</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">name</span><br /><span class="hljs-bullet">                  -</span> <span class="hljs-string">hobbies</span><br /><span class="hljs-attr">                properties:</span><br /><span class="hljs-attr">                  id:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">number</span><br /><span class="hljs-attr">                  name:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">string</span><br /><span class="hljs-attr">                  hobbies:</span><br /><span class="hljs-attr">                    type:</span> <span class="hljs-string">array</span><br /><span class="hljs-attr">                    items:</span><br /><span class="hljs-attr">                      type:</span> <span class="hljs-string">string</span><br /></code></pre>
</span></div></div></div></div>
<p>The argument in <code>spyCall.args[0]</code> is an <code>UnmockRequest</code> object and the <code>returnValue</code> is an <code>UnmockResponse</code> object as <a href="#unmockrequest">defined below</a>.</p>
<p>Because Unmock service spies are Sinon JS spy objects, you can also use <a href="https://sinonjs.org/releases/v7.4.1/assertions/">SinonJS assert</a> for more expressive assertions such as <code>calledOnce</code>:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> { assert, match } <span class="hljs-keyword">from</span> <span class="hljs-string">"sinon"</span>;
assert.calledOnce(github.spy);
assert.calledOnceWith(github.spy, match({ <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span> }));
</code></pre>
<p>If you're not using <code>sinon</code> in your project, you can import <code>sinon</code> from <code>unmock</code>:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> { sinon } <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="requests-and-responses"></a><a href="#requests-and-responses" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Requests and responses</h2>
<p>The most important thing you'll need to know when working with Unmock assertions is how HTTP(S) requests and responses are represented at a lower level. To make assertions about things in HTTP-land like queries or headers, you need to use <code>UnmockRequest</code> and <code>UnmockResponse</code> objects.</p>
<h3><a class="anchor" aria-hidden="true" id="unmockrequest"></a><a href="#unmockrequest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>UnmockRequest</code></h3>
<p>An <code>UnmockRequest</code> is an object with the following fields. When used with <code>sinon</code>, the fields can be <a href="https://sinonjs.org/releases/v7.4.1/matchers/">Sinon matchers</a>, or the whole object can be enclosed in a matcher.</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-attr">protocol</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">// the protocol, either http or https</span>
  host: <span class="hljs-string">""</span>, <span class="hljs-comment">// the host, like foo.com or bar.org</span>
  method: <span class="hljs-string">""</span>, <span class="hljs-comment">// the HTTP method (get, post, etc.)</span>
  path: <span class="hljs-string">""</span>, <span class="hljs-comment">// the full path that was called, including query parameters</span>
  pathname: <span class="hljs-string">""</span>, <span class="hljs-comment">// the path that was called without query parameters</span>
  headers: {}, <span class="hljs-comment">// the headers, represented as key-value pairs</span>
  body: {}, <span class="hljs-comment">// the body, a JSON object if it is a form or json, otherwise a string</span>
  query: {}  <span class="hljs-comment">// query parameters as key-value pairs</span>
}
</code></pre>
<p>Here is how one can use <code>match</code> on an Unmock request object to perform assertions on specific requests.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-9-tab-10" class="nav-link active" data-group="group_9" data-tab="tab-group-9-content-10">Test</div><div id="tab-group-9-tab-11" class="nav-link" data-group="group_9" data-tab="tab-group-9-content-11">Code</div></div><div class="tab-content"><div id="tab-group-9-content-10" class="tab-pane active" data-group="group_9" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// createUser.test.js</span><br /><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;<br /><span class="hljs-keyword">import</span> createUser <span class="hljs-keyword">from</span> <span class="hljs-string">"./createUser"</span>;<br /><span class="hljs-keyword">import</span> { assert, match } <span class="hljs-keyword">from</span> <span class="hljs-string">"sinon"</span>;<br /><br /><span class="hljs-keyword">const</span> { myapi } = unmock.on().services;<br /><br />test(<span class="hljs-string">"augmented user object composed correctly"</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />  <span class="hljs-keyword">await</span> createUser({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Jane"</span>, <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> });<br />  <span class="hljs-keyword">await</span> createUser({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span>, <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span> });<br />  <span class="hljs-comment">// Access the first request body with a matcher</span><br />  <span class="hljs-keyword">const</span> firstRequestBody = myapi.spy.postRequestBody(<br />    match({ <span class="hljs-attr">body</span>: match({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Jane"</span> }) })<br />  );<br />  <span class="hljs-comment">// Assert "type" field was set to "admin"</span><br />  expect(firstRequestBody).toMatchObject({ <span class="hljs-attr">type</span>: <span class="hljs-string">"admin"</span> });<br />  <span class="hljs-comment">// Access the second request body with a matcher</span><br />  <span class="hljs-keyword">const</span> secondRequestBody = myapi.spy.postRequestBody(<br />    match({ <span class="hljs-attr">body</span>: match({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span> }) })<br />  );<br />  <span class="hljs-comment">// Assert "type" field was set to "user"</span><br />  expect(secondtRequestBody).toMatchObject({ <span class="hljs-attr">type</span>: <span class="hljs-string">"user"</span> });<br />});<br /><br />afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi.reset();<br />});<br /></code></pre>
</span></div></div><div id="tab-group-9-content-11" class="tab-pane" data-group="group_9" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// createUser.js</span><br /><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> ({ name, isAdmin }) =&gt; {<br />  <span class="hljs-keyword">const</span> { data } = axios.post(<span class="hljs-string">"https://myapi.com/users/"</span>, {<br />    name,<br />    <span class="hljs-attr">type</span>: isAdmin ? <span class="hljs-string">"user"</span> : <span class="hljs-string">"admin"</span>,<br />  });<br />  <span class="hljs-keyword">return</span> data;<br />};<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="unmockresponse"></a><a href="#unmockresponse" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>UnmockResponse</code></h3>
<p>Similarly, an object <code>UnmockResponse</code> can be used to verify API responses.</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>, <span class="hljs-comment">// the status code as a number</span>
  headers: {}, <span class="hljs-comment">// the headers, represented as key-value pairs</span>
  body: {}, <span class="hljs-comment">// the body, a JSON object if it is a form or json, otherwise a string</span>
}
</code></pre>
<p>We've avoided being too preachy in this documentation, but it's important to make one small suggestion at this point. When possible, avoid writing tests that test Unmock more than your own code. Often times, the barrier is subtle, but in the case below, the assertion about the status code can be removed - it makes the test longer, and only tells us that Unmock is working.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-12-tab-13" class="nav-link active" data-group="group_12" data-tab="tab-group-12-content-13">Test</div><div id="tab-group-12-tab-14" class="nav-link" data-group="group_12" data-tab="tab-group-12-content-14">Code</div></div><div class="tab-content"><div id="tab-group-12-content-13" class="tab-pane active" data-group="group_12" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.test.js</span><br /><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock"</span>;<br /><span class="hljs-keyword">import</span> getAugmentedUser <span class="hljs-keyword">from</span> <span class="hljs-string">"./getAugmentedUser"</span>;<br /><span class="hljs-keyword">import</span> { assert, match } <span class="hljs-keyword">from</span> <span class="hljs-string">"sinon"</span>;<br /><br /><span class="hljs-keyword">const</span> { myapi } = unmock.on().services;<br /><br />test(<span class="hljs-string">"augmented user object composed correctly"</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />  <span class="hljs-keyword">const</span> augmentedUser = <span class="hljs-keyword">await</span> getAugmentedUser(<span class="hljs-number">42</span>);<br />  <span class="hljs-comment">// below is a garbage-in-garbage-out expectation using the statusCode</span><br />  <span class="hljs-comment">// of the UnmockResponse object. while this may be useful for debugging,</span><br />  <span class="hljs-comment">// it should be avoided when possible, as it tests your test but not</span><br />  <span class="hljs-comment">// your code</span><br />  expect(<span class="hljs-number">200</span>).toBe(myapi.spy.firstCall.returnValue.statusCode);<br />  <span class="hljs-comment">// uses the "body" field of the UnmockResponse object</span><br />  expect(augmentedUser).toMatchObject(myapi.spy.getResponseBody());<br />});<br /><br />afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<br />  myapi.reset();<br />});<br /></code></pre>
</span></div></div><div id="tab-group-12-content-14" class="tab-pane" data-group="group_12" tabindex="-1"><div><span><pre><code class="hljs css language-javascript"><span class="hljs-comment">// augmentedUser.js</span><br /><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> id =&gt; {<br />  <span class="hljs-keyword">const</span> { data } = axios(<span class="hljs-string">"https://myapi.com/users/"</span> + id);<br />  <span class="hljs-keyword">return</span> {<br />    ...data,<br />    <span class="hljs-attr">fetchedOn</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br />    <span class="hljs-attr">seenInSession</span>: <span class="hljs-literal">false</span>,<br />  };<br />};<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="resetting-spy"></a><a href="#resetting-spy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resetting spy</h2>
<p>Spy history can be reset as follows:</p>
<pre><code class="hljs css language-js">service.spy.resetHistory(); <span class="hljs-comment">// Reset a single spy, leave everything else intact</span>
service.reset(); <span class="hljs-comment">// Reset service, including its spy</span>
</code></pre>
<p>Resetting the spy history empties the list of calls so that <code>spy.getCalls</code> is an empty list.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/openapi"><span class="arrow-prev">← </span><span class="function-name-prevnext">Using OpenAPI</span></a><a class="docs-next button" href="/docs/setting-state"><span>Initializing Mocks</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#spying">Spying</a></li><li><a href="#paths-and-headers-and-bodies-oh-my">Paths and Headers and Bodies, Oh My!</a></li><li><a href="#advanced-usage">Advanced usage</a></li><li><a href="#requests-and-responses">Requests and responses</a><ul class="toc-headings"><li><a href="#unmockrequest"><code>UnmockRequest</code></a></li><li><a href="#unmockresponse"><code>UnmockResponse</code></a></li></ul></li><li><a href="#resetting-spy">Resetting spy</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Unmock" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/introduction">Introduction</a><a href="https://github.com/unmock/unmock-examples">Examples</a></div><div><h5>Community</h5><a href="https://gitter.im/unmock/community">Gitter</a><a href="https://twitter.com/unmockapis?lang=en" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/unmock">GitHub</a><a href="https://github.com/unmock/code-of-conduct">Code of Conduct</a></div></section><section class="copyright">Copyright © 2019 <a href="https://meeshkan.com">Meeshkan</a></section></footer></div></body></html>